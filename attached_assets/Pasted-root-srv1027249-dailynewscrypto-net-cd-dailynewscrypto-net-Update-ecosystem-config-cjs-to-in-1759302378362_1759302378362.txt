root@srv1027249:~/dailynewscrypto.net# cd ~/dailynewscrypto.net

# Update ecosystem.config.cjs to include environment variables
cat > ecosystem.config.cjs << 'EOF'
module.exports = {
  apps: [{
    name: 'mapestate-api',
    script: './dist/index.js',
    instances: 1,
    exec_mode: 'fork',
    env: {
      NODE_ENV: 'production',
      PORT: 3000,
      MYSQL_HOST: 'localhost',
      MYSQL_PORT: '3306',
      MYSQL_USER: 'mapestate',
      MYSQL_PASSWORD: 'MapEstate2025!@#',
      MYSQL_DATABASE: 'mapestate',
      DOMAIN: 'dailynewscrypto.net',
      FRONTEND_URL: 'https://dailynewscrypto.net',
      SESSION_SECRET: 'your-super-secret-session-key-change-this',
      JWT_SECRET: 'your-jwt-secret-key-change-this'
    },
    env_production: {
      NODE_ENV: 'production',
      PORT: 3000,
      MYSQL_HOST: 'localhost',
      MYSQL_PORT: '3306',
      MYSQL_USER: 'mapestate',
      MYSQL_PASSWORD: 'MapEstate2025!@#',
      MYSQL_DATABASE: 'mapestate',
      DOMAIN: 'dailynewscrypto.net',
      FRONTEND_URL: 'https://dailynewscrypto.net',
      SESSION_SECRET: 'your-super-secret-session-key-change-this',
      JWT_SECRET: 'your-jwt-secret-key-change-this'
    },
    log_file: './logs/combined.log',
    out_file: './logs/out.log',
    error_file: './logs/error.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
    watch: false,
pm2 logs mapestate-api --lines 30onnection successublic'],
[PM2] Applying action deleteProcessId on app [mapestate-api](ids: [ 0 ])
[PM2] [mapestate-api](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2][WARN] Applications mapestate-api not running, starting...
[PM2] App [mapestate-api] launched (1 instances)
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ mapestate-api      │ fork     │ 0    │ online    │ 0%       │ 18.5mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /root/.pm2/dump.pm2
[TAILING] Tailing last 30 lines for [mapestate-api] process (change the value with --lines option)
/root/dailynewscrypto.net/logs/error-0.log last 30 lines:
0|mapestat | 2025-10-01 07:02:32 +00:00:   sqlMessage: "Access denied for user 'mapestate'@'localhost' (using password: YES)"
0|mapestat | 2025-10-01 07:02:32 +00:00: }
0|mapestat | 2025-10-01 07:02:32 +00:00: ❌ Failed to connect to MySQL VPS database:
0|mapestat | 2025-10-01 07:02:32 +00:00:    Error: Error: Access denied for user 'mapestate'@'localhost' (using password: YES)
0|mapestat | 2025-10-01 07:02:32 +00:00: ⚠️ No database configured, using in-memory storage for development
0|mapestat | 2025-10-01 07:02:32 +00:00: 💡 Set MYSQL_URL environment variable to use a database
0|mapestat | 2025-10-01 07:02:32 +00:00: Warning: connect.session() MemoryStore is not
0|mapestat | 2025-10-01 07:02:32 +00:00: designed for a production environment, as it will leak
0|mapestat | 2025-10-01 07:02:32 +00:00: memory, and will not scale past a single process.
0|mapestat | 2025-10-01 07:03:37 +00:00: ⚠️ Connection test failed: Error: Access denied for user 'mapestate'@'localhost' (using password: YES)
0|mapestat | 2025-10-01 07:03:37 +00:00:     at PromisePool.query (/root/dailynewscrypto.net/node_modules/mysql2/lib/promise/pool.js:36:22)
0|mapestat | 2025-10-01 07:03:37 +00:00:     at initializeDb (file:///root/dailynewscrypto.net/dist/index.js:1547:25)
0|mapestat | 2025-10-01 07:03:37 +00:00:     at StorageFactory.getStorage (file:///root/dailynewscrypto.net/dist/index.js:2471:17)
0|mapestat | 2025-10-01 07:03:37 +00:00:     at file:///root/dailynewscrypto.net/dist/index.js:4959:35
0|mapestat | 2025-10-01 07:03:37 +00:00:     at file:///root/dailynewscrypto.net/dist/index.js:4990:3
0|mapestat | 2025-10-01 07:03:37 +00:00:     at ModuleJob.run (node:internal/modules/esm/module_job:325:25)
0|mapestat | 2025-10-01 07:03:37 +00:00:     at async ModuleLoader.import (node:internal/modules/esm/loader:606:24) {
0|mapestat | 2025-10-01 07:03:37 +00:00:   code: 'ER_ACCESS_DENIED_ERROR',
0|mapestat | 2025-10-01 07:03:37 +00:00:   errno: 1045,
0|mapestat | 2025-10-01 07:03:37 +00:00:   sql: undefined,
0|mapestat | 2025-10-01 07:03:37 +00:00:   sqlState: '28000',
0|mapestat | 2025-10-01 07:03:37 +00:00:   sqlMessage: "Access denied for user 'mapestate'@'localhost' (using password: YES)"
0|mapestat | 2025-10-01 07:03:37 +00:00: }
0|mapestat | 2025-10-01 07:03:37 +00:00: ❌ Failed to connect to MySQL VPS database:
0|mapestat | 2025-10-01 07:03:37 +00:00:    Error: Error: Access denied for user 'mapestate'@'localhost' (using password: YES)
0|mapestat | 2025-10-01 07:03:37 +00:00: ⚠️ No database configured, using in-memory storage for development
0|mapestat | 2025-10-01 07:03:37 +00:00: 💡 Set MYSQL_URL environment variable to use a database
0|mapestat | 2025-10-01 07:03:37 +00:00: Warning: connect.session() MemoryStore is not
0|mapestat | 2025-10-01 07:03:37 +00:00: designed for a production environment, as it will leak
0|mapestat | 2025-10-01 07:03:37 +00:00: memory, and will not scale past a single process.

/root/dailynewscrypto.net/logs/out-0.log last 30 lines:
0|mapestat | 2025-10-01 07:02:32 +00:00:    Host: localhost:3306
0|mapestat | 2025-10-01 07:02:32 +00:00:    User: mapestate
0|mapestat | 2025-10-01 07:02:32 +00:00:    Database: mapestate
0|mapestat | 2025-10-01 07:02:32 +00:00: 🔄 Connecting to MySQL VPS database...
0|mapestat | 2025-10-01 07:02:32 +00:00: ✅ MySQL VPS connection established successfully
0|mapestat | 2025-10-01 07:02:32 +00:00: 🔍 Testing database connection...
0|mapestat | 2025-10-01 07:02:32 +00:00: 💾 Using MemStorage (in-memory) - DEVELOPMENT ONLY
0|mapestat | 2025-10-01 07:02:32 +00:00: 🔧 Running startup fix for user language permissions...
0|mapestat | 2025-10-01 07:02:32 +00:00: 📁 Serving uploads from: /root/dailynewscrypto.net/dist/uploads
0|mapestat | 2025-10-01 07:02:32 +00:00: 7:02:32 AM [express] serving on port 3000
0|mapestat | 2025-10-01 07:03:37 +00:00: 🔍 Environment Variables Debug:
0|mapestat | 2025-10-01 07:03:37 +00:00:    MYSQL_URL: [NOT SET]
0|mapestat | 2025-10-01 07:03:37 +00:00:    MYSQL_HOST: [SET]
0|mapestat | 2025-10-01 07:03:37 +00:00:    MYSQL_USER: [SET]
0|mapestat | 2025-10-01 07:03:37 +00:00:    MYSQL_DATABASE: [SET]
0|mapestat | 2025-10-01 07:03:37 +00:00:    MYSQL_PORT: 3306
0|mapestat | 2025-10-01 07:03:37 +00:00:    MYSQL_PASSWORD: [SET]
0|mapestat | 2025-10-01 07:03:37 +00:00: 🔗 Using MySQL VPS configuration from environment variables
0|mapestat | 2025-10-01 07:03:37 +00:00: 🔧 MySQL VPS: mysql://mapestate:***@localhost:3306/mapestate
0|mapestat | 2025-10-01 07:03:37 +00:00: 🔗 Database configuration:
0|mapestat | 2025-10-01 07:03:37 +00:00:    Host: localhost:3306
0|mapestat | 2025-10-01 07:03:37 +00:00:    User: mapestate
0|mapestat | 2025-10-01 07:03:37 +00:00:    Database: mapestate
0|mapestat | 2025-10-01 07:03:37 +00:00: 🔄 Connecting to MySQL VPS database...
0|mapestat | 2025-10-01 07:03:37 +00:00: ✅ MySQL VPS connection established successfully
0|mapestat | 2025-10-01 07:03:37 +00:00: 🔍 Testing database connection...
0|mapestat | 2025-10-01 07:03:37 +00:00: 💾 Using MemStorage (in-memory) - DEVELOPMENT ONLY
0|mapestat | 2025-10-01 07:03:37 +00:00: 🔧 Running startup fix for user language permissions...
0|mapestat | 2025-10-01 07:03:37 +00:00: 📁 Serving uploads from: /root/dailynewscrypto.net/dist/uploads
0|mapestat | 2025-10-01 07:03:38 +00:00: 7:03:38 AM [express] serving on port 3000

0|mapestate-api  | 2025-10-01 07:03:52 +00:00: 🔍 Environment Variables Debug:
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:    MYSQL_URL: [NOT SET]
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:    MYSQL_HOST: [SET]
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:    MYSQL_USER: [SET]
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:    MYSQL_DATABASE: [SET]
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:    MYSQL_PORT: 3306
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:    MYSQL_PASSWORD: [SET]
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: 🔗 Using MySQL VPS configuration from environment variables
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: 🔧 MySQL VPS: mysql://mapestate:***@localhost:3306/mapestate
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: 🔗 Database configuration:
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:    Host: localhost:3306
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:    User: mapestate
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:    Database: mapestate
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: 🔄 Connecting to MySQL VPS database...
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: ✅ MySQL VPS connection established successfully
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: 🔍 Testing database connection...
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: ⚠️ Connection test failed: Error: Access denied for user 'mapestate'@'localhost' (using password: YES)
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:     at PromisePool.query (/root/dailynewscrypto.net/node_modules/mysql2/lib/promise/pool.js:36:22)
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:     at initializeDb (file:///root/dailynewscrypto.net/dist/index.js:1547:25)
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:     at StorageFactory.getStorage (file:///root/dailynewscrypto.net/dist/index.js:2471:17)
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:     at file:///root/dailynewscrypto.net/dist/index.js:4959:35
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:     at file:///root/dailynewscrypto.net/dist/index.js:4990:3
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:     at ModuleJob.run (node:internal/modules/esm/module_job:325:25)
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:     at async ModuleLoader.import (node:internal/modules/esm/loader:606:24) {
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:   code: 'ER_ACCESS_DENIED_ERROR',
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:   errno: 1045,
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:   sql: undefined,
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:   sqlState: '28000',
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:   sqlMessage: "Access denied for user 'mapestate'@'localhost' (using password: YES)"
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: }
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: ❌ Failed to connect to MySQL VPS database:
0|mapestate-api  | 2025-10-01 07:03:52 +00:00:    Error: Error: Access denied for user 'mapestate'@'localhost' (using password: YES)
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: ⚠️ No database configured, using in-memory storage for development
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: 💡 Set MYSQL_URL environment variable to use a database
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: 💾 Using MemStorage (in-memory) - DEVELOPMENT ONLY
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: 🔧 Running startup fix for user language permissions...
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: Warning: connect.session() MemoryStore is not
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: designed for a production environment, as it will leak
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: memory, and will not scale past a single process.
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: 📁 Serving uploads from: /root/dailynewscrypto.net/dist/uploads
0|mapestate-api  | 2025-10-01 07:03:52 +00:00: 7:03:52 AM [express] serving on port 3000
^C
root@srv1027249:~/dailynewscrypto.net# # Connect to MySQL and fix the user
sudo mysql -u root << 'MYSQL_EOF'
-- Drop the existing user and recreate with a simpler password
DROP USER IF EXISTS 'mapestate'@'localhost';
DROP USER IF EXISTS 'mapestate'@'%';

-- Create user with a password that doesn't need escaping
CREATE USER 'mapestate'@'localhost' IDENTIFIED BY 'MapEstate2025';
GRANT ALL PRIVILEGES ON mapestate.* TO 'mapestate'@'localhost';

-- For remote access
CREATE USER 'mapestate'@'%' IDENTIFIED BY 'MapEstate2025';
GRANT ALL PRIVILEGES ON mapestate.* TO 'mapestate'@'%';

FLUSH PRIVILEGES;

-- Verify user was created
SELECT User, Host FROM mysql.user WHERE User='mapestate';
MYSQL_EOF

# Update PM2 config with the new password
cd ~/dailynewscrypto.net
cat > ecosystem.config.cjs << 'EOF'
module.exports = {
  apps: [{
    name: 'mapestate-api',
    script: './dist/index.js',
    instances: 1,
    exec_mode: 'fork',
    env: {
      NODE_ENV: 'production',
      PORT: 3000,
      MYSQL_HOST: 'localhost',
      MYSQL_PORT: '3306',
      MYSQL_USER: 'mapestate',
      MYSQL_PASSWORD: 'MapEstate2025',
      MYSQL_DATABASE: 'mapestate',
      DOMAIN: 'dailynewscrypto.net',
      FRONTEND_URL: 'https://dailynewscrypto.net',
      SESSION_SECRET: 'your-super-secret-session-key-change-this',
      JWT_SECRET: 'your-jwt-secret-key-change-this'
pm2 logs mapestate-api --lines 25 successfullyst/public'],e-this',
mysql: [ERROR] Found option without preceding group in config file /etc/mysql/mysql.conf.d/security.cnf at line 1.
mysql: [ERROR] Stopped processing the 'includedir' directive in file /etc/mysql/my.cnf at line 21.
ERROR 1819 (HY000) at line 6: Your password does not satisfy the current policy requirements
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [mapestate-api](ids: [ 0 ])
[PM2] [mapestate-api](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ mapestate-api      │ fork     │ 1    │ online    │ 0%       │ 17.8mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[TAILING] Tailing last 25 lines for [mapestate-api] process (change the value with --lines option)
/root/dailynewscrypto.net/logs/error-0.log last 25 lines:
0|mapestat | 2025-10-01 07:03:37 +00:00: 💡 Set MYSQL_URL environment variable to use a database
0|mapestat | 2025-10-01 07:03:37 +00:00: Warning: connect.session() MemoryStore is not
0|mapestat | 2025-10-01 07:03:37 +00:00: designed for a production environment, as it will leak
0|mapestat | 2025-10-01 07:03:37 +00:00: memory, and will not scale past a single process.
0|mapestat | 2025-10-01 07:03:52 +00:00: ⚠️ Connection test failed: Error: Access denied for user 'mapestate'@'localhost' (using password: YES)
0|mapestat | 2025-10-01 07:03:52 +00:00:     at PromisePool.query (/root/dailynewscrypto.net/node_modules/mysql2/lib/promise/pool.js:36:22)
0|mapestat | 2025-10-01 07:03:52 +00:00:     at initializeDb (file:///root/dailynewscrypto.net/dist/index.js:1547:25)
0|mapestat | 2025-10-01 07:03:52 +00:00:     at StorageFactory.getStorage (file:///root/dailynewscrypto.net/dist/index.js:2471:17)
0|mapestat | 2025-10-01 07:03:52 +00:00:     at file:///root/dailynewscrypto.net/dist/index.js:4959:35
0|mapestat | 2025-10-01 07:03:52 +00:00:     at file:///root/dailynewscrypto.net/dist/index.js:4990:3
0|mapestat | 2025-10-01 07:03:52 +00:00:     at ModuleJob.run (node:internal/modules/esm/module_job:325:25)
0|mapestat | 2025-10-01 07:03:52 +00:00:     at async ModuleLoader.import (node:internal/modules/esm/loader:606:24) {
0|mapestat | 2025-10-01 07:03:52 +00:00:   code: 'ER_ACCESS_DENIED_ERROR',
0|mapestat | 2025-10-01 07:03:52 +00:00:   errno: 1045,
0|mapestat | 2025-10-01 07:03:52 +00:00:   sql: undefined,
0|mapestat | 2025-10-01 07:03:52 +00:00:   sqlState: '28000',
0|mapestat | 2025-10-01 07:03:52 +00:00:   sqlMessage: "Access denied for user 'mapestate'@'localhost' (using password: YES)"
0|mapestat | 2025-10-01 07:03:52 +00:00: }
0|mapestat | 2025-10-01 07:03:52 +00:00: ❌ Failed to connect to MySQL VPS database:
0|mapestat | 2025-10-01 07:03:52 +00:00:    Error: Error: Access denied for user 'mapestate'@'localhost' (using password: YES)
0|mapestat | 2025-10-01 07:03:52 +00:00: ⚠️ No database configured, using in-memory storage for development
0|mapestat | 2025-10-01 07:03:52 +00:00: 💡 Set MYSQL_URL environment variable to use a database
0|mapestat | 2025-10-01 07:03:52 +00:00: Warning: connect.session() MemoryStore is not
0|mapestat | 2025-10-01 07:03:52 +00:00: designed for a production environment, as it will leak
0|mapestat | 2025-10-01 07:03:52 +00:00: memory, and will not scale past a single process.

/root/dailynewscrypto.net/logs/out-0.log last 25 lines:
0|mapestat | 2025-10-01 07:03:37 +00:00: 🔍 Testing database connection...
0|mapestat | 2025-10-01 07:03:37 +00:00: 💾 Using MemStorage (in-memory) - DEVELOPMENT ONLY
0|mapestat | 2025-10-01 07:03:37 +00:00: 🔧 Running startup fix for user language permissions...
0|mapestat | 2025-10-01 07:03:37 +00:00: 📁 Serving uploads from: /root/dailynewscrypto.net/dist/uploads
0|mapestat | 2025-10-01 07:03:38 +00:00: 7:03:38 AM [express] serving on port 3000
0|mapestat | 2025-10-01 07:03:52 +00:00: 🔍 Environment Variables Debug:
0|mapestat | 2025-10-01 07:03:52 +00:00:    MYSQL_URL: [NOT SET]
0|mapestat | 2025-10-01 07:03:52 +00:00:    MYSQL_HOST: [SET]
0|mapestat | 2025-10-01 07:03:52 +00:00:    MYSQL_USER: [SET]
0|mapestat | 2025-10-01 07:03:52 +00:00:    MYSQL_DATABASE: [SET]
0|mapestat | 2025-10-01 07:03:52 +00:00:    MYSQL_PORT: 3306
0|mapestat | 2025-10-01 07:03:52 +00:00:    MYSQL_PASSWORD: [SET]
0|mapestat | 2025-10-01 07:03:52 +00:00: 🔗 Using MySQL VPS configuration from environment variables
0|mapestat | 2025-10-01 07:03:52 +00:00: 🔧 MySQL VPS: mysql://mapestate:***@localhost:3306/mapestate
0|mapestat | 2025-10-01 07:03:52 +00:00: 🔗 Database configuration:
0|mapestat | 2025-10-01 07:03:52 +00:00:    Host: localhost:3306
0|mapestat | 2025-10-01 07:03:52 +00:00:    User: mapestate
0|mapestat | 2025-10-01 07:03:52 +00:00:    Database: mapestate
0|mapestat | 2025-10-01 07:03:52 +00:00: 🔄 Connecting to MySQL VPS database...
0|mapestat | 2025-10-01 07:03:52 +00:00: ✅ MySQL VPS connection established successfully
0|mapestat | 2025-10-01 07:03:52 +00:00: 🔍 Testing database connection...
0|mapestat | 2025-10-01 07:03:52 +00:00: 💾 Using MemStorage (in-memory) - DEVELOPMENT ONLY
0|mapestat | 2025-10-01 07:03:52 +00:00: 🔧 Running startup fix for user language permissions...
0|mapestat | 2025-10-01 07:03:52 +00:00: 📁 Serving uploads from: /root/dailynewscrypto.net/dist/uploads
0|mapestat | 2025-10-01 07:03:52 +00:00: 7:03:52 AM [express] serving on port 3000

0|mapestate-api  | 2025-10-01 07:04:53 +00:00: 🔍 Environment Variables Debug:
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:    MYSQL_URL: [NOT SET]
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:    MYSQL_HOST: [SET]
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:    MYSQL_USER: [SET]
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:    MYSQL_DATABASE: [SET]
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:    MYSQL_PORT: 3306
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:    MYSQL_PASSWORD: [SET]
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: 🔗 Using MySQL VPS configuration from environment variables
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: 🔧 MySQL VPS: mysql://mapestate:***@localhost:3306/mapestate
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: 🔗 Database configuration:
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:    Host: localhost:3306
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:    User: mapestate
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:    Database: mapestate
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: 🔄 Connecting to MySQL VPS database...
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: ✅ MySQL VPS connection established successfully
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: 🔍 Testing database connection...
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: ⚠️ Connection test failed: Error: Access denied for user 'mapestate'@'localhost' (using password: YES)
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:     at PromisePool.query (/root/dailynewscrypto.net/node_modules/mysql2/lib/promise/pool.js:36:22)
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:     at initializeDb (file:///root/dailynewscrypto.net/dist/index.js:1547:25)
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:     at StorageFactory.getStorage (file:///root/dailynewscrypto.net/dist/index.js:2471:17)
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:     at file:///root/dailynewscrypto.net/dist/index.js:4959:35
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:     at file:///root/dailynewscrypto.net/dist/index.js:4990:3
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:     at ModuleJob.run (node:internal/modules/esm/module_job:325:25)
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:     at async ModuleLoader.import (node:internal/modules/esm/loader:606:24) {
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:   code: 'ER_ACCESS_DENIED_ERROR',
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:   errno: 1045,
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:   sql: undefined,
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:   sqlState: '28000',
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:   sqlMessage: "Access denied for user 'mapestate'@'localhost' (using password: YES)"
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: }
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: ❌ Failed to connect to MySQL VPS database:
0|mapestate-api  | 2025-10-01 07:04:53 +00:00:    Error: Error: Access denied for user 'mapestate'@'localhost' (using password: YES)
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: ⚠️ No database configured, using in-memory storage for development
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: 💡 Set MYSQL_URL environment variable to use a database
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: 💾 Using MemStorage (in-memory) - DEVELOPMENT ONLY
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: 🔧 Running startup fix for user language permissions...
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: Warning: connect.session() MemoryStore is not
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: designed for a production environment, as it will leak
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: memory, and will not scale past a single process.
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: 📁 Serving uploads from: /root/dailynewscrypto.net/dist/uploads
0|mapestate-api  | 2025-10-01 07:04:53 +00:00: 7:04:53 AM [express] serving on port 3000
^C
root@srv1027249:~/dailynewscrypto.net# # Check what users exist in MySQL
sudo mysql -u root -e "SELECT User, Host, plugin FROM mysql.user WHERE User='mapestate';"
mysql: [ERROR] Found option without preceding group in config file /etc/mysql/mysql.conf.d/security.cnf at line 1.
mysql: [ERROR] Stopped processing the 'includedir' directive in file /etc/mysql/my.cnf at line 21.
root@srv1027249:~/dailynewscrypto.net# # Drop and recreate the user with a clean password
sudo mysql -u root << 'EOF'
-- Remove any existing mapestate users
DROP USER IF EXISTS 'mapestate'@'localhost';
DROP USER IF EXISTS 'mapestate'@'%';

-- Create fresh user with simple password (no special chars)
CREATE USER 'mapestate'@'localhost' IDENTIFIED BY 'MapEstate2025';
GRANT ALL PRIVILEGES ON mapestate.* TO 'mapestate'@'localhost';
FLUSH PRIVILEGES;

-- Verify it was created
SELECT User, Host FROM mysql.user WHERE User='mapestate';
EOF
mysql: [ERROR] Found option without preceding group in config file /etc/mysql/mysql.conf.d/security.cnf at line 1.
mysql: [ERROR] Stopped processing the 'includedir' directive in file /etc/mysql/my.cnf at line 21.
ERROR 1819 (HY000) at line 6: Your password does not satisfy the current policy requirements
root@srv1027249:~/dailynewscrypto.net# # Test the connection works
mysql -u mapestate -p'MapEstate2025' -e "SHOW DATABASES;"
mysql: [ERROR] Found option without preceding group in config file /etc/mysql/mysql.conf.d/security.cnf at line 1.
mysql: [ERROR] Stopped processing the 'includedir' directive in file /etc/mysql/my.cnf at line 21.
mysql: [Warning] Using a password on the command line interface can be insecure.
ERROR 1045 (28000): Access denied for user 'mapestate'@'localhost' (using password: YES)
root@srv1027249:~/dailynewscrypto.net# cd ~/dailynewscrypto.net

cat > ecosystem.config.cjs << 'EOF'
module.exports = {
  apps: [{
    name: 'mapestate-api',
    script: './dist/index.js',
    instances: 1,
    exec_mode: 'fork',
    env_production: {
      NODE_ENV: 'production',
      PORT: 3000,
      MYSQL_HOST: 'localhost',
      MYSQL_PORT: '3306',
      MYSQL_USER: 'mapestate',
      MYSQL_PASSWORD: 'MapEstate2025',
      MYSQL_DATABASE: 'mapestate',
      DOMAIN: 'dailynewscrypto.net',
      FRONTEND_URL: 'https://dailynewscrypto.net',
      SESSION_SECRET: 'change-this-secret-key',
      JWT_SECRET: 'change-this-jwt-secret'
    },
    log_file: './logs/combined.log',
    out_file: './logs/out.log',
    error_file: './logs/error.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
    watch: false,
    max_memory_restart: '1G'
  }]
};
EOF
root@srv1027249:~/dailynewscrypto.net# # Restart with updated config
pm2 restart mapestate-api --update-env

# Monitor logs
pm2 logs mapestate-api --lines 20
[PM2] Applying action restartProcessId on app [mapestate-api](ids: [ 0 ])
[PM2] [mapestate-api](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ mapestate-api      │ fork     │ 2    │ online    │ 0%       │ 12.3mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[TAILING] Tailing last 20 lines for [mapestate-api] process (change the value with --lines option)
/root/dailynewscrypto.net/logs/error-0.log last 20 lines:
0|mapestat | 2025-10-01 07:04:53 +00:00:     at PromisePool.query (/root/dailynewscrypto.net/node_modules/mysql2/lib/promise/pool.js:36:22)
0|mapestat | 2025-10-01 07:04:53 +00:00:     at initializeDb (file:///root/dailynewscrypto.net/dist/index.js:1547:25)
0|mapestat | 2025-10-01 07:04:53 +00:00:     at StorageFactory.getStorage (file:///root/dailynewscrypto.net/dist/index.js:2471:17)
0|mapestat | 2025-10-01 07:04:53 +00:00:     at file:///root/dailynewscrypto.net/dist/index.js:4959:35
0|mapestat | 2025-10-01 07:04:53 +00:00:     at file:///root/dailynewscrypto.net/dist/index.js:4990:3
0|mapestat | 2025-10-01 07:04:53 +00:00:     at ModuleJob.run (node:internal/modules/esm/module_job:325:25)
0|mapestat | 2025-10-01 07:04:53 +00:00:     at async ModuleLoader.import (node:internal/modules/esm/loader:606:24) {
0|mapestat | 2025-10-01 07:04:53 +00:00:   code: 'ER_ACCESS_DENIED_ERROR',
0|mapestat | 2025-10-01 07:04:53 +00:00:   errno: 1045,
0|mapestat | 2025-10-01 07:04:53 +00:00:   sql: undefined,
0|mapestat | 2025-10-01 07:04:53 +00:00:   sqlState: '28000',
0|mapestat | 2025-10-01 07:04:53 +00:00:   sqlMessage: "Access denied for user 'mapestate'@'localhost' (using password: YES)"
0|mapestat | 2025-10-01 07:04:53 +00:00: }
0|mapestat | 2025-10-01 07:04:53 +00:00: ❌ Failed to connect to MySQL VPS database:
0|mapestat | 2025-10-01 07:04:53 +00:00:    Error: Error: Access denied for user 'mapestate'@'localhost' (using password: YES)
0|mapestat | 2025-10-01 07:04:53 +00:00: ⚠️ No database configured, using in-memory storage for development
0|mapestat | 2025-10-01 07:04:53 +00:00: 💡 Set MYSQL_URL environment variable to use a database
0|mapestat | 2025-10-01 07:04:53 +00:00: Warning: connect.session() MemoryStore is not
0|mapestat | 2025-10-01 07:04:53 +00:00: designed for a production environment, as it will leak
0|mapestat | 2025-10-01 07:04:53 +00:00: memory, and will not scale past a single process.

/root/dailynewscrypto.net/logs/out-0.log last 20 lines:
0|mapestat | 2025-10-01 07:04:53 +00:00: 🔍 Environment Variables Debug:
0|mapestat | 2025-10-01 07:04:53 +00:00:    MYSQL_URL: [NOT SET]
0|mapestat | 2025-10-01 07:04:53 +00:00:    MYSQL_HOST: [SET]
0|mapestat | 2025-10-01 07:04:53 +00:00:    MYSQL_USER: [SET]
0|mapestat | 2025-10-01 07:04:53 +00:00:    MYSQL_DATABASE: [SET]
0|mapestat | 2025-10-01 07:04:53 +00:00:    MYSQL_PORT: 3306
0|mapestat | 2025-10-01 07:04:53 +00:00:    MYSQL_PASSWORD: [SET]
0|mapestat | 2025-10-01 07:04:53 +00:00: 🔗 Using MySQL VPS configuration from environment variables
0|mapestat | 2025-10-01 07:04:53 +00:00: 🔧 MySQL VPS: mysql://mapestate:***@localhost:3306/mapestate
0|mapestat | 2025-10-01 07:04:53 +00:00: 🔗 Database configuration:
0|mapestat | 2025-10-01 07:04:53 +00:00:    Host: localhost:3306
0|mapestat | 2025-10-01 07:04:53 +00:00:    User: mapestate
0|mapestat | 2025-10-01 07:04:53 +00:00:    Database: mapestate
0|mapestat | 2025-10-01 07:04:53 +00:00: 🔄 Connecting to MySQL VPS database...
0|mapestat | 2025-10-01 07:04:53 +00:00: ✅ MySQL VPS connection established successfully
0|mapestat | 2025-10-01 07:04:53 +00:00: 🔍 Testing database connection...
0|mapestat | 2025-10-01 07:04:53 +00:00: 💾 Using MemStorage (in-memory) - DEVELOPMENT ONLY
0|mapestat | 2025-10-01 07:04:53 +00:00: 🔧 Running startup fix for user language permissions...
0|mapestat | 2025-10-01 07:04:53 +00:00: 📁 Serving uploads from: /root/dailynewscrypto.net/dist/uploads
0|mapestat | 2025-10-01 07:04:53 +00:00: 7:04:53 AM [express] serving on port 3000

0|mapestate-api  | 2025-10-01 07:06:13 +00:00: 🔍 Environment Variables Debug:
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:    MYSQL_URL: [NOT SET]
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:    MYSQL_HOST: [SET]
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:    MYSQL_USER: [SET]
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:    MYSQL_DATABASE: [SET]
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:    MYSQL_PORT: 3306
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:    MYSQL_PASSWORD: [SET]
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: 🔗 Using MySQL VPS configuration from environment variables
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: 🔧 MySQL VPS: mysql://mapestate:***@localhost:3306/mapestate
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: 🔗 Database configuration:
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:    Host: localhost:3306
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:    User: mapestate
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:    Database: mapestate
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: 🔄 Connecting to MySQL VPS database...
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: ✅ MySQL VPS connection established successfully
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: 🔍 Testing database connection...
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: ⚠️ Connection test failed: Error: Access denied for user 'mapestate'@'localhost' (using password: YES)
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:     at PromisePool.query (/root/dailynewscrypto.net/node_modules/mysql2/lib/promise/pool.js:36:22)
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:     at initializeDb (file:///root/dailynewscrypto.net/dist/index.js:1547:25)
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:     at StorageFactory.getStorage (file:///root/dailynewscrypto.net/dist/index.js:2471:17)
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:     at file:///root/dailynewscrypto.net/dist/index.js:4959:35
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:     at file:///root/dailynewscrypto.net/dist/index.js:4990:3
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:     at ModuleJob.run (node:internal/modules/esm/module_job:325:25)
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:     at async ModuleLoader.import (node:internal/modules/esm/loader:606:24) {
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:   code: 'ER_ACCESS_DENIED_ERROR',
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:   errno: 1045,
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:   sql: undefined,
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:   sqlState: '28000',
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:   sqlMessage: "Access denied for user 'mapestate'@'localhost' (using password: YES)"
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: }
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: ❌ Failed to connect to MySQL VPS database:
0|mapestate-api  | 2025-10-01 07:06:13 +00:00:    Error: Error: Access denied for user 'mapestate'@'localhost' (using password: YES)
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: ⚠️ No database configured, using in-memory storage for development
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: 💡 Set MYSQL_URL environment variable to use a database
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: 💾 Using MemStorage (in-memory) - DEVELOPMENT ONLY
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: 🔧 Running startup fix for user language permissions...
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: Warning: connect.session() MemoryStore is not
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: designed for a production environment, as it will leak
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: memory, and will not scale past a single process.
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: 📁 Serving uploads from: /root/dailynewscrypto.net/dist/uploads
0|mapestate-api  | 2025-10-01 07:06:13 +00:00: 7:06:13 AM [express] serving on port 3000
