root@srv1027249:~/dailynewscrypto.net# cd ~/dailynewscrypto.net
cat > ecosystem.config.js << 'EOF'
module.exports = {
  apps: [{
    name: 'mapestate-app',
    script: 'server/index.ts',
    interpreter: 'npx',
    interpreter_args: 'tsx',
    env: {
      NODE_ENV: 'production',
      MYSQL_HOST: 'localhost',
      MYSQL_USER: 'mapestate',
      MYSQL_PASSWORD: 'Mapestate123!',
      MYSQL_DATABASE: 'mapestate',
      MYSQL_PORT: '3306'
    }
  }]
};
EOF

pm2 delete mapestate-app
pm2 start ecosystem.config.js
pm2 save
pm2 logs mapestate-app --lines 30
[PM2][ERROR] Process or Namespace mapestate-app not found
[PM2][ERROR] File ecosystem.config.js malformated
ReferenceError: module is not defined in ES module scope
This file is being treated as an ES module because it has a '.js' file extension and '/root/dailynewscrypto.net/package.json' contains "type": "module". To treat it as a CommonJS script, rename it to use the '.cjs' file extension.
    at file:///root/dailynewscrypto.net/ecosystem.config.js:1:1
    at ModuleJobSync.runSync (node:internal/modules/esm/module_job:437:37)
    at ModuleLoader.importSyncForRequire (node:internal/modules/esm/loader:389:47)
    at loadESMFromCJS (node:internal/modules/cjs/loader:1363:24)
    at Module._compile (node:internal/modules/cjs/loader:1503:5)
    at Module._extensions..js (node:internal/modules/cjs/loader:1623:10)
    at Module.load (node:internal/modules/cjs/loader:1266:32)
    at Module._load (node:internal/modules/cjs/loader:1091:12)
    at Module.require (node:internal/modules/cjs/loader:1289:19)
    at require (node:internal/modules/helpers:182:18)
[PM2] Saving current process list...
[PM2][WARN] PM2 is not managing any process, skipping save...
[PM2][WARN] To force saving use: pm2 save --force
[TAILING] Tailing last 30 lines for [mapestate-app] process (change the value with --lines option)
^C
root@srv1027249:~/dailynewscrypto.net# cd ~/dailynewscrypto.net
rm ecosystem.config.js
cat > ecosystem.config.cjs << 'EOF'
module.exports = {
  apps: [{
    name: 'mapestate-app',
    script: 'server/index.ts',
    interpreter: 'npx',
    interpreter_args: 'tsx',
    env: {
      NODE_ENV: 'production',
      MYSQL_HOST: 'localhost',
      MYSQL_USER: 'mapestate',
      MYSQL_PASSWORD: 'Mapestate123!',
      MYSQL_DATABASE: 'mapestate',
      MYSQL_PORT: '3306'
    }
  }]
};
EOF

pm2 start ecosystem.config.cjs
pm2 save
pm2 logs mapestate-app --lines 30
[PM2][WARN] Applications mapestate-app not running, starting...
[PM2] App [mapestate-app] launched (1 instances)
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name               â”‚ mode     â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ memory   â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ mapestate-app      â”‚ fork     â”‚ 0    â”‚ online    â”‚ 0%       â”‚ 10.4mb   â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
[PM2] Saving current process list...
[PM2] Successfully saved in /root/.pm2/dump.pm2
[TAILING] Tailing last 30 lines for [mapestate-app] process (change the value with --lines option)
/root/.pm2/logs/mapestate-app-error.log last 30 lines:
0|mapestat |     at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5) {
0|mapestat |   code: 'ECONNREFUSED',
0|mapestat |   errno: -111,
0|mapestat |   sql: undefined,
0|mapestat |   sqlState: undefined,
0|mapestat |   sqlMessage: undefined
0|mapestat | }
0|mapestat | âŒ Failed to connect to MySQL VPS database:
0|mapestat |    Error: Error: connect ECONNREFUSED 72.60.134.44:3306
0|mapestat | âš ï¸ No database configured, using in-memory storage for development
0|mapestat | ğŸ’¡ Set MYSQL_URL environment variable to use a database
0|mapestat | âš ï¸ Connection test failed: Error: connect ECONNREFUSED 72.60.134.44:3306
0|mapestat |     at PromisePool.query (/root/dailynewscrypto.net/node_modules/mysql2/lib/promise/pool.js:36:22)
0|mapestat |     at initializeDb (/root/dailynewscrypto.net/server/db.ts:36:25)
0|mapestat |     at Function.getStorage (/root/dailynewscrypto.net/server/storageFactory.ts:19:13)
0|mapestat |     at <anonymous> (/root/dailynewscrypto.net/server/index.ts:272:34)
0|mapestat |     at <anonymous> (/root/dailynewscrypto.net/server/index.ts:322:1)
0|mapestat |     at ModuleJob.run (node:internal/modules/esm/module_job:325:25)
0|mapestat |     at async ModuleLoader.import (node:internal/modules/esm/loader:606:24)
0|mapestat |     at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5) {
0|mapestat |   code: 'ECONNREFUSED',
0|mapestat |   errno: -111,
0|mapestat |   sql: undefined,
0|mapestat |   sqlState: undefined,
0|mapestat |   sqlMessage: undefined
0|mapestat | }
0|mapestat | âŒ Failed to connect to MySQL VPS database:
0|mapestat |    Error: Error: connect ECONNREFUSED 72.60.134.44:3306
0|mapestat | âš ï¸ No database configured, using in-memory storage for development
0|mapestat | ğŸ’¡ Set MYSQL_URL environment variable to use a database

/root/.pm2/logs/mapestate-app-out.log last 30 lines:
0|mapestat |    Host: 72.60.134.44:3306
0|mapestat |    User: mapestate
0|mapestat |    Database: mapestate
0|mapestat | ğŸ”„ Connecting to MySQL VPS database...
0|mapestat | âœ… MySQL VPS connection established successfully
0|mapestat | ğŸ” Testing database connection...
0|mapestat | ğŸ’¾ Using MemStorage (in-memory) - DEVELOPMENT ONLY
0|mapestat | ğŸ”§ Running startup fix for user language permissions...
0|mapestat | ğŸ“ Serving uploads from: /root/dailynewscrypto.net/server/uploads
0|mapestat | 3:21:51 PM [express] serving on port 5000
0|mapestat | ğŸ” Environment Variables Debug:
0|mapestat |    MYSQL_URL: [NOT SET]
0|mapestat |    MYSQL_HOST: [NOT SET]
0|mapestat |    MYSQL_USER: [NOT SET]
0|mapestat |    MYSQL_DATABASE: [NOT SET]
0|mapestat |    MYSQL_PORT: [NOT SET]
0|mapestat |    MYSQL_PASSWORD: [NOT SET]
0|mapestat | ğŸ“ No MYSQL_URL found, using default configuration from environment variables
0|mapestat | ğŸ’¡ Tip: Set environment variables MYSQL_HOST, MYSQL_USER, MYSQL_PASSWORD, MYSQL_DATABASE
0|mapestat | ğŸ”— Database configuration:
0|mapestat |    Host: 72.60.134.44:3306
0|mapestat |    User: mapestate
0|mapestat |    Database: mapestate
0|mapestat | ğŸ”„ Connecting to MySQL VPS database...
0|mapestat | âœ… MySQL VPS connection established successfully
0|mapestat | ğŸ” Testing database connection...
0|mapestat | ğŸ’¾ Using MemStorage (in-memory) - DEVELOPMENT ONLY
0|mapestat | ğŸ”§ Running startup fix for user language permissions...
0|mapestat | ğŸ“ Serving uploads from: /root/dailynewscrypto.net/server/uploads
0|mapestat | 3:23:05 PM [express] serving on port 5000

0|mapestate-app  | ğŸ” Environment Variables Debug:
0|mapestate-app  |    MYSQL_URL: [NOT SET]
0|mapestate-app  |    MYSQL_HOST: [SET]
0|mapestate-app  |    MYSQL_USER: [SET]
0|mapestate-app  |    MYSQL_DATABASE: [SET]
0|mapestate-app  |    MYSQL_PORT: 3306
0|mapestate-app  |    MYSQL_PASSWORD: [SET]
0|mapestate-app  | ğŸ”— Using MySQL VPS configuration from environment variables
0|mapestate-app  | ğŸ”§ MySQL VPS: mysql://mapestate:***@localhost:3306/mapestate
0|mapestate-app  | ğŸ”— Database configuration:
0|mapestate-app  |    Host: localhost:3306
0|mapestate-app  |    User: mapestate
0|mapestate-app  |    Database: mapestate
0|mapestate-app  | ğŸ”„ Connecting to MySQL VPS database...
0|mapestate-app  | âœ… MySQL VPS connection established successfully
0|mapestate-app  | ğŸ” Testing database connection...
0|mapestate-app  | ğŸ’“ Database connection is healthy
0|mapestate-app  | âœ… MySQL database initialized successfully
0|mapestate-app  | ğŸ”— Using MySQL DatabaseStorage
0|mapestate-app  | ğŸ”§ Running startup fix for user language permissions...
0|mapestate-app  | ğŸ”§ Fixing existing users language permissions...
0|mapestate-app  | Found 0 regular users to fix
0|mapestate-app  | âœ… Finished fixing existing users language permissions
0|mapestate-app  | Warning: connect.session() MemoryStore is not
0|mapestate-app  | designed for a production environment, as it will leak
0|mapestate-app  | memory, and will not scale past a single process.
0|mapestate-app  | ğŸ“ Serving uploads from: /root/dailynewscrypto.net/server/uploads
0|mapestate-app  | /root/dailynewscrypto.net/server/vite.local.ts:79
0|mapestate-app  |     throw new Error(
0|mapestate-app  |           ^
0|mapestate-app  | Error: Could not find the build directory: /root/dailynewscrypto.net/server/public, make sure to build the client first
0|mapestate-app  |     at serveStatic (/root/dailynewscrypto.net/server/vite.local.ts:79:11)
0|mapestate-app  |     at <anonymous> (/root/dailynewscrypto.net/server/index.ts:300:5)
0|mapestate-app  |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
0|mapestate-app  | Node.js v20.19.5
0|mapestate-app  | ğŸ” Environment Variables Debug:
0|mapestate-app  |    MYSQL_URL: [NOT SET]
0|mapestate-app  |    MYSQL_HOST: [SET]
0|mapestate-app  |    MYSQL_USER: [SET]
0|mapestate-app  |    MYSQL_DATABASE: [SET]
0|mapestate-app  |    MYSQL_PORT: 3306
0|mapestate-app  |    MYSQL_PASSWORD: [SET]
0|mapestate-app  | ğŸ”— Using MySQL VPS configuration from environment variables
0|mapestate-app  | ğŸ”§ MySQL VPS: mysql://mapestate:***@localhost:3306/mapestate
0|mapestate-app  | ğŸ”— Database configuration:
0|mapestate-app  |    Host: localhost:3306
0|mapestate-app  |    User: mapestate
0|mapestate-app  |    Database: mapestate
0|mapestate-app  | ğŸ”„ Connecting to MySQL VPS database...
0|mapestate-app  | âœ… MySQL VPS connection established successfully
0|mapestate-app  | ğŸ” Testing database connection...
0|mapestate-app  | ğŸ’“ Database connection is healthy
0|mapestate-app  | âœ… MySQL database initialized successfully
0|mapestate-app  | ğŸ”— Using MySQL DatabaseStorage
0|mapestate-app  | ğŸ”§ Running startup fix for user language permissions...
0|mapestate-app  | ğŸ”§ Fixing existing users language permissions...
0|mapestate-app  | Found 0 regular users to fix
0|mapestate-app  | âœ… Finished fixing existing users language permissions
0|mapestate-app  | Warning: connect.session() MemoryStore is not
0|mapestate-app  | designed for a production environment, as it will leak
0|mapestate-app  | memory, and will not scale past a single process.
0|mapestate-app  | ğŸ“ Serving uploads from: /root/dailynewscrypto.net/server/uploads
0|mapestate-app  | /root/dailynewscrypto.net/server/vite.local.ts:79
0|mapestate-app  |     throw new Error(
0|mapestate-app  |           ^
0|mapestate-app  | Error: Could not find the build directory: /root/dailynewscrypto.net/server/public, make sure to build the client first
0|mapestate-app  |     at serveStatic (/root/dailynewscrypto.net/server/vite.local.ts:79:11)
0|mapestate-app  |     at <anonymous> (/root/dailynewscrypto.net/server/index.ts:300:5)
0|mapestate-app  |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
0|mapestate-app  | Node.js v20.19.5
^C
root@srv1027249:~/dailynewscrypto.net# 