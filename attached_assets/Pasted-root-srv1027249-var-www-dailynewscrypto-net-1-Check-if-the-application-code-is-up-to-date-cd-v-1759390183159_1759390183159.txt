root@srv1027249:/var/www/dailynewscrypto.net# # 1. Check if the application code is up to date
cd /var/www/dailynewscrypto.net
git pull  # or however you deploy updates

# 2. Rebuild the application
npm install
npm run build

# 3. Check if uploads directory exists and has proper permissions
ls -la /var/www/shared/uploads/properties/
# Should show the image files with proper permissions

# 4. Check Nginx configuration
cat /etc/nginx/sites-available/dailynewscrypto.net | grep -A 10 "uploads"
# Should have a location block that proxies /uploads/ to your Node.js app

# 5. Restart the application
pm2 restart mapestate
pm2 logs mapestate --lines 50
fatal: not a git repository (or any of the parent directories): .git
npm error code ENOENT
npm error syscall open
npm error path /var/www/dailynewscrypto.net/package.json
npm error errno -2
npm error enoent Could not read package.json: Error: ENOENT: no such file or directory, open '/var/www/dailynewscrypto.net/package.json'
npm error enoent This is related to npm not being able to find a file.
npm error enoent
npm error A complete log of this run can be found in: /root/.npm/_logs/2025-10-02T07_29_37_961Z-debug-0.log
npm error code ENOENT
npm error syscall open
npm error path /var/www/dailynewscrypto.net/package.json
npm error errno -2
npm error enoent Could not read package.json: Error: ENOENT: no such file or directory, open '/var/www/dailynewscrypto.net/package.json'
npm error enoent This is related to npm not being able to find a file.
npm error enoent
npm error A complete log of this run can be found in: /root/.npm/_logs/2025-10-02T07_29_38_264Z-debug-0.log
total 8
drwxr-x--- 2 www-data www-data 4096 Oct  1 17:16 .
drwxr-x--- 5 www-data www-data 4096 Oct  1 17:16 ..
# This configuration fixes the image serving issues by properly handling uploads
# Place this in /etc/nginx/sites-available/yourdomain.com

# Add these to /etc/nginx/nginx.conf in the http { } block:
# limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
# limit_req_zone $binary_remote_addr zone=login:10m rate=1r/s;

server {
    listen 80;
    server_name dailynewscrypto.net www.dailynewscrypto.net;
    
--
    # CRITICAL FIX: Security - Block access to non-image files in uploads (must come first)
    location ~ ^/uploads/.*\.(php|js|html|txt|sh|exe)$ {
        return 403;
    }
location /uploads/ {
        alias /root/dailynewscrypto.net/server/uploads/;
        expires 1y;
        add_header Cache-Control "public, immutable";
        try_files $uri $uri/ =404;
    }
    
    # Serve static assets
    location /assets/ {
        alias /root/dailynewscrypto.net/dist/public/assets/;
        expires 1y;
        add_header Cache-Control "public, immutable";
--
    # CRITICAL FIX: Proxy ALL /uploads requests to Node.js with highest priority
    # The ^~ modifier ensures this takes precedence over regex locations
    # This ensures uploaded images are served correctly through Express
    location ^~ /uploads/ {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # Cache settings for images
        expires 30d;
Use --update-env to update environment variables
[PM2][ERROR] Process or Namespace mapestate not found
[TAILING] Tailing last 50 lines for [mapestate] process (change the value with --lines option)
^C
root@srv1027249:/var/www/dailynewscrypto.net# 