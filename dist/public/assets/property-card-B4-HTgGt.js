import{c as D,r as o,j as t,m as R,u as E,d as q,b as O,p as U,B as I,q as H}from"./index-gVtgMtKL.js";import{C as V,a as K}from"./card-C2dwsEa1.js";import{B as Q}from"./badge-BqUsHcl3.js";import{f as _,g as G,h as J}from"./use-properties-BAMJa5MG.js";import{C as W,a as X,S as Y}from"./square-CK4v9LDE.js";import{H as Z,M as ee}from"./map-pin-BZWIKE3O.js";import{B as te,a as ae}from"./bed-Bvsx4--5.js";import{U as se}from"./user-Bs_15JvR.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=D("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]),ne=e=>e.includes("unsplash.com")?{webp:{"320w":`${e}&fm=webp&w=320&dpr=1`,"640w":`${e}&fm=webp&w=640&dpr=1`,"960w":`${e}&fm=webp&w=960&dpr=1`,"1280w":`${e}&fm=webp&w=1280&dpr=1`,"1920w":`${e}&fm=webp&w=1920&dpr=1`},jpg:{"320w":`${e}&fm=jpg&w=320&dpr=1`,"640w":`${e}&fm=jpg&w=640&dpr=1`,"960w":`${e}&fm=jpg&w=960&dpr=1`,"1280w":`${e}&fm=jpg&w=1280&dpr=1`,"1920w":`${e}&fm=jpg&w=1920&dpr=1`}}:null,re="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600",z=o.forwardRef(({src:e,alt:c,fallbackSrc:j=re,priority:r=!1,sizes:N="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 33vw",aspectRatio:i="auto",objectFit:$="cover",blur:u=!1,className:x,onLoad:g,onError:f,...p},k)=>{const[w,d]=o.useState(!1),[b,m]=o.useState(!1),[n,C]=o.useState(e),P=o.useRef(null),l=ne(e);o.useEffect(()=>{C(e),m(!1),d(!1)},[e]);const S=()=>{d(!0),g==null||g()},F=()=>{n!==j?(C(j),m(!1)):m(!0),f==null||f()},y={square:"aspect-square","4/3":"aspect-[4/3]","16/9":"aspect-video","3/2":"aspect-[3/2]",auto:""}[i],A=`object-${$}`;return o.useEffect(()=>{if(r&&l){const s=document.createElement("link");return s.rel="preload",s.as="image",s.href=l.webp["960w"],s.type="image/webp",document.head.appendChild(s),()=>{document.head.removeChild(s)}}},[r,l]),b?t.jsx("div",{className:R("bg-muted flex items-center justify-center text-muted-foreground text-sm",y,x),children:"Failed to load image"}):t.jsxs("picture",{className:R("block",x),children:[l&&t.jsxs(t.Fragment,{children:[t.jsx("source",{type:"image/webp",srcSet:Object.entries(l.webp).map(([s,v])=>`${v} ${s}`).join(", "),sizes:N}),t.jsx("source",{type:"image/jpeg",srcSet:Object.entries(l.jpg).map(([s,v])=>`${v} ${s}`).join(", "),sizes:N})]}),t.jsx("img",{ref:k||P,src:n,alt:c,className:R("w-full h-full transition-opacity duration-300",y,A,w?"opacity-100":"opacity-0",u&&!w&&"blur-sm",x),loading:r?"eager":"lazy",decoding:r?"sync":"async",fetchPriority:r?"high":"auto",onLoad:S,onError:F,"data-testid":"optimized-image",...p})]})});z.displayName="OptimizedImage";function ge({property:e,userId:c,className:j,onMapClick:r,showMapButton:N=!1}){var L;const{t:i,getLocalized:$,isRTL:u}=E(),[,x]=q(),g=_(),f=G(),{data:p}=J(c||"",e.id),[k,w]=o.useState(0),{preferredCurrency:d}=O(),b=(p==null?void 0:p.isFavorite)||!1,m=U(e.currency,d),n=e.images&&e.images.length>0?e.images:["https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600"],C=n.length>1,P=async a=>{if(a.preventDefault(),a.stopPropagation(),!!c)try{b?await f.mutateAsync({userId:c,propertyId:e.id}):await g.mutateAsync({userId:c,propertyId:e.id})}catch(h){console.error("Failed to update favorite:",h)}},l=a=>{a.preventDefault(),a.stopPropagation(),w(h=>(h+1)%n.length)},S=a=>{a.preventDefault(),a.stopPropagation(),w(h=>(h-1+n.length)%n.length)},F=parseFloat(e.price),y=(L=m.data)!=null&&L.convertedAmount?m.data.convertedAmount*F:F,A=e.currency===d?e.currency:d,s=a=>{a.preventDefault(),a.stopPropagation();const M=window.location.pathname.match(/^\/(en|ar|kur)\//),B=M?`/${M[1]}`:"/en",T=e.slug||e.id;x(`${B}/property/${T}`)},v=a=>{a.preventDefault(),a.stopPropagation(),r&&r(e)};return t.jsxs(V,{className:`property-card bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden transition-all duration-300 hover:-translate-y-2 hover:shadow-xl shadow-lg group ${j}`,"data-testid":`property-card-${e.id}`,children:[t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"relative h-48 sm:h-52 md:h-56 lg:h-48 xl:h-52 overflow-hidden",children:[t.jsx(z,{src:n[k],alt:e.title,className:"transition-transform duration-500 group-hover:scale-105",aspectRatio:"3/2",objectFit:"cover",sizes:"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw",fallbackSrc:"https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600",width:400,height:267}),C&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:S,className:"absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white rounded-full p-2 h-10 w-10 flex items-center justify-center transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white/20","aria-label":"Previous image",children:t.jsx(W,{className:"h-5 w-5"})}),t.jsx("button",{onClick:l,className:"absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white rounded-full p-2 h-10 w-10 flex items-center justify-center transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white/20","aria-label":"Next image",children:t.jsx(X,{className:"h-5 w-5"})}),t.jsxs("div",{className:`absolute bottom-2 ${u?"left-2":"right-2"} bg-black/50 text-white px-2 py-1 rounded text-xs`,children:[k+1," / ",n.length]})]})]}),t.jsx(Q,{className:`absolute top-4 ${u?"right-4":"left-4"} ${e.listingType==="sale"?"bg-red-600 text-white":"bg-green-600 text-white"}`,children:e.listingType==="sale"?i("filter.forSale"):i("filter.forRent")}),c&&t.jsx(I,{variant:"ghost",size:"icon",onClick:P,className:`absolute top-4 ${u?"left-4":"right-4"} rounded-full p-2 transition-all duration-200 ${b?"bg-red-50 hover:bg-red-100 text-red-500 border border-red-200":"bg-black/50 hover:bg-black/70 text-white"}`,"data-testid":`favorite-button-${e.id}`,children:t.jsx(Z,{className:`h-4 w-4 transition-all duration-200 ${b?"fill-current scale-110":"hover:scale-105"}`})})]}),t.jsxs(K,{className:"p-4 sm:p-5 md:p-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 mb-3",children:[t.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white line-clamp-2 sm:line-clamp-1 flex-1 pr-2","data-testid":`property-title-${e.id}`,title:$(e.title,e.title),children:$(e.title,e.title)}),t.jsx("span",{className:"text-xl sm:text-2xl font-bold text-orange-600 dark:text-orange-400 whitespace-nowrap","data-testid":`property-price-${e.id}`,children:H(e.price,e.currency,e.listingType,A,y,i)})]}),t.jsxs("div",{className:"flex items-start text-gray-600 dark:text-gray-300 mb-4",children:[t.jsx(ee,{className:"h-4 w-4 mr-2 mt-0.5 flex-shrink-0"}),t.jsxs("p",{className:"text-sm sm:text-base line-clamp-2 leading-relaxed","data-testid":`property-address-${e.id}`,title:`${e.address}, ${e.city}`,children:[e.address,", ",e.city]})]}),t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3 text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-4",children:[e.bedrooms&&t.jsxs("div",{className:"flex items-center",children:[t.jsx(te,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1",style:{color:"#FF7800"}}),t.jsxs("span",{className:"truncate",children:[e.bedrooms," ",i("property.beds")]})]}),e.bathrooms&&t.jsxs("div",{className:"flex items-center",children:[t.jsx(ae,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1",style:{color:"#FF7800"}}),t.jsxs("span",{className:"truncate",children:[e.bathrooms," ",i("property.baths")]})]}),e.area&&t.jsxs("div",{className:"flex items-center col-span-2 sm:col-span-1",children:[t.jsx(Y,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1",style:{color:"#FF7800"}}),t.jsxs("span",{className:"truncate",children:[e.area.toLocaleString()," ",i("property.sqFt")]})]})]}),t.jsxs("div",{className:"space-y-3",children:[e.agent&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-orange-100 dark:bg-orange-900 rounded-full flex items-center justify-center",children:t.jsx(se,{className:"h-3 w-3 sm:h-4 sm:w-4 text-orange-600 dark:text-orange-400"})}),t.jsxs("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-300 truncate",children:[e.agent.firstName," ",e.agent.lastName]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[N&&t.jsx(I,{onClick:v,variant:"outline",size:"sm",className:"bg-orange-50 hover:bg-orange-100 border-orange-200 text-orange-600 px-3 h-8 sm:h-9","data-testid":`map-button-${e.id}`,title:"Show on map",children:t.jsx(ie,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),t.jsx(I,{onClick:s,className:"flex-1 h-8 sm:h-9 text-xs sm:text-sm","data-testid":`view-details-button-${e.id}`,children:i("property.viewDetails")})]})]})]})]})}export{ge as P};
